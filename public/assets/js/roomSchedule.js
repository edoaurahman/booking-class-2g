const schedule = [
  {
    day: "Sunday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah OOP",
      },
    ],
  },
  {
    day: "Monday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
    ],
  },
  {
    day: "Tuesday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
    ],
  },
  {
    day: "Wednesday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
    ],
  },
  {
    day: "Thursday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
    ],
  },
  {
    day: "Friday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
    ],
  },
  {
    day: "Saturday",
    schedule: [
      {
        id: 1,
        timeStart: "07.00",
        timeEnd: "07.50",
        user: "TI-2G",
        activity: "Kuliah Database",
      },
      {
        id: 2,
        timeStart: "07.50",
        timeEnd: "08.40",
        user: "TI-2G",
        activity: "Kuliah OOPS",
      },
      {
        id: 3,
        timeStart: "08.40",
        timeEnd: "09.30",
        user: "TI-2G",
        activity: "Kuliah SIMAN",
      },
      {
        id: 4,
        timeStart: "09.30",
        timeEnd: "10.20",
        user: "TI-2G",
        activity: "Kuliah MANPRO",
      },
      {
        id: 5,
        timeStart: "10.20",
        timeEnd: "11.10",
        user: "TI-2G",
        activity: "Kuliah DESPRO WEB",
      },
      {
        id: 6,
        timeStart: "11.10",
        timeEnd: "12.00",
        user: "TI-3G",
        activity: "Kuliah MATEMATIKA 3",
      },
    ],
  },
];

const date = new Date();
const scheduleTime = document.querySelector(".schedule-clock");
const scheduleDay = document.querySelector(".schedule-day");
const scheduleTableBody = document.querySelector(".schedule-table-body");
const currentSchedule_el = document.querySelector(".current-schedule");
let counter = 0;

document.addEventListener("DOMContentLoaded", () => {
  const day = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  const month = [
    "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec",
  ];

  function updateTime() {
    scheduleTime.textContent = `${date.getHours() < 10 ? "0" + date.getHours() : date.getHours()}.${
      date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes()
    }`;
  }

  function updateDay() {
    scheduleDay.innerHTML = `
      <h1 class="text-4xl">${day[date.getDay()]}, ${date.getDate()} ${month[date.getMonth()]} ${date.getFullYear()}</h1>
      <div class="w-full h-full absolute flex justify-between text-white z-[9999] top-0 items-center  ">
        <button class="schedule-prev-button h-10 w-10 lg:w-[4rem] lg:h-[4rem] bg-transparent">
          <img src="/assets/img/arahTriangle.svg" alt="" class="w-full h-full rotate-90 schedule-prev-button">
        </button>
        <button class="schedule-next-button h-10 w-10 lg:w-[4rem] lg:h-[4rem] bg-transparent">
          <img src="/assets/img/arahTriangle.svg" alt="" class="w-full h-full schedule-next-button">
        </button>
      </div>`;
  }

  function update_display() {
    if (counter >= 7) {
      counter = 0;
    } else {
      counter++;
    }
    date.setDate(date.getDate() + 1);
    updateTime();
    updateDay();
    updateSchedule();
    updateCurrentSchedule();
  }

  function updateSchedule() {
    scheduleTableBody.innerHTML = "";
    const schedulesToday = schedule[date.getDay()];
    const currentSchedule = get_currentScedule().filter(schedule => schedule !== null);

    schedulesToday.schedule.forEach((scedule) => {

      const row = document.createElement("tr");
      (scedule.id === currentSchedule[0]?.id) ? row.classList.add("bg-bingu") : null
      row.innerHTML = `
        <td class="px-6 py-4">${scedule.id}</td>
        <td class="px-6 py-4">${scedule.timeStart}</td>
        <td class="px-6 py-4">${scedule.timeEnd}</td>
        <td class="px-6 py-4">${scedule.user}</td>
        <td class="px-6 py-4">${scedule.activity}</td>`;
      scheduleTableBody.appendChild(row);
    });
  }

  function updateCurrentSchedule() {
    const currentScheduleTable = get_currentScedule();   

    currentSchedule_el.innerHTML = `${currentScheduleTable.length > 0 ? 
      `
      <h1 class="text-2xl"><strong>NOW</strong> </h1>
      <h1 class="text-2xl">${currentScheduleTable[0].activity} </h1>
      <h1 class="text-2xl">${currentScheduleTable[0].user}</h1>
      ` : 
      `<h1 class="text-2xl"><strong>NOW</strong> is free</h1>`}`;
  }

  const get_currentScedule = () => {
    const currentDate = new Date();
    currentSchedule_el.innerHTML = "";
    const currentSchedule = schedule[currentDate.getDay()];
    const currentHour = currentDate.getHours();
    const currentMinute = currentDate.getMinutes();
    
    const currentScheduleTable = currentSchedule.schedule.map((scedule) => {
      const timeStart = scedule.timeStart.split(".");
      const hourStart = parseInt(timeStart[0]);
      const minuteStart = parseInt(timeStart[1]);
      const timeEnd = scedule.timeEnd.split(".");
      const hourEnd = parseInt(timeEnd[0]);
      const minuteEnd = parseInt(timeEnd[1]);

      const isCurrentStarting = (currentHour === hourStart && currentMinute >= minuteStart) || (currentHour > hourStart);
      const isCurrentEnding = (currentHour === hourEnd && currentMinute <= minuteEnd) || (currentHour < hourEnd);

      if (isCurrentStarting && isCurrentEnding) {
        return scedule;
      } else {
        return null;
      }
    });

    return currentScheduleTable.filter(schedule => schedule !== null);
  }

  // Initial rendering
  updateTime();
  updateDay();
  updateSchedule();
  updateCurrentSchedule();

  // Event listener for button clicks
  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("schedule-next-button")) {
      update_display();
    } else if (e.target.classList.contains("schedule-prev-button")) {
      counter--;
      date.setDate(date.getDate() - 1);
      updateTime();
      updateDay();
      updateSchedule();
      updateCurrentSchedule();
    }
  });
});